var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(q){return q.raw=q};$jscomp.createTemplateTagFirstArgWithRaw=function(q,D){q.raw=D;return q};
var Image2Video=function(){function q(){if(0>z)l(m,[{level:"error",message:"Conversion failed"}]),console.error("Conversion failed"),u=!1,z=0,l(E,[null,null]);else{for(var a=null==F?c.captureStream():c.captureStream(F),b="video/webm;codecs=h264 video/webm;codecs=vp8 video/webm;codecs=daala video/webm audio/webm;codecs=opus video/mpeg".split(" "),g=null,d=0;d<b.length;d++)if(MediaRecorder.isTypeSupported(b[d])){g=b[d];break}null==g?(l(m,[{level:"error",message:"No MIME-TYPE available for this browser"}]),
console.error("No MIME-TYPE available for this browser")):(null!=h&&(h=null),h=new MediaRecorder(a,{mimeType:g,ignoreMutedMedia:!0}),h.ondataavailable=function(f){0<f.data.size?(f=new Blob([f.data],{type:f.data.type}),l(E,[f,"webm"]),u=!1,h=null):(h=null,z--,1==e.length&&(e=[e[0],e[0]]),q())},h.onerror=function(f){console.error("error recording stream: "+f.error.name)},h.start(),1==r?K():D())}}function D(a){a=void 0===a?-1:a;a++;l(G,[a/e.length]);if(e[a]){H.drawImage(e[a],0,0);A.drawImage(p,0,0,p.width,
p.height,0,0,c.width,c.height);var b;setTimeout(function(){return D(a)},null!=(b=I)?b:500)}else null!=h&&h.stop()}function K(a){a=void 0===a?-1:a;a++;var b,g=null!=(b=I)?b:500;(b=v)&&l(G,[a/e.length]);(function(){if(t[a]){var d=t[a].canvas.width,f=t[a].canvas.height,k=(c.width-d)/2,B=(c.height-f)/2;A.clearRect(0,0,c.width,c.height);var C=0;v||(v=!0,C=1);A.drawImage(t[a].canvas,C,0,d,f,k,B,d,f);return!1}v=!1;h.stop();return!0})()||(v!=b&&(a--,g=0),setTimeout(function(){return K(a)},g))}function w(a){return a&&
"function"===typeof a}function l(a,b){b=void 0===b?null:b;if(w(a))try{if(null==b)return a();if(b instanceof Array)switch(b.length){case 1:return a(b[0]);case 2:return a(b[0],b[1]);default:return a()}}catch(g){w(m)&&(m({level:"error",message:g.name+" | "+g.message+" | "+g.stack}),console.error(g))}return null}function n(){return 1==u?(l(m,[{level:"warn",message:"Do not call while convert is running"}]),console.warn("Do not call while convert is running"),!0):!1}var r=1,u=!1,z=0,F=null,h=null,e=[],
t=[],v=!1,c=null,A=null,p=null,H=null,J=null,G=null,E=null,m=null,I=null,x=3840,y=2160;return{init:function(){if(!n()){c=document.createElement("canvas");p=document.createElement("canvas");u=!1;null!=h&&(h=null);for(var a=0;a<e.length;a++){var b=e[0].src;e[0].onload=null;e[0].src="";URL.revokeObjectURL(b)}e=[];m=E=G=J=H=A=null;z=0;x=3840;y=2160;F=null;t=[];v=!1}},getRecordState:function(){return u},loadImages:function(a){if(!n()){for(var b=0;b<e.length;b++){var g=e[b].src;e[b].onload=null;e[b].src=
"";URL.revokeObjectURL(g)}e=[];var d=[];for(b={$jscomp$loop$prop$i$14$19:0};b.$jscomp$loop$prop$i$14$19<a.length;b={$jscomp$loop$prop$i$14$19:b.$jscomp$loop$prop$i$14$19,$jscomp$loop$prop$reader$20:b.$jscomp$loop$prop$reader$20},b.$jscomp$loop$prop$i$14$19++)b.$jscomp$loop$prop$reader$20=new FileReader,b.$jscomp$loop$prop$reader$20.onload=function(f){return function(){var k=document.createElement("img");k.onload=function(){d.push({index:f.$jscomp$loop$prop$i$14$19,element:k});d.length==a.length&&
(e=d.sort(function(B,C){return B.index-C.index}).map(function(B,C,L){return B.element}),l(J))};k.src=f.$jscomp$loop$prop$reader$20.result}}(b),b.$jscomp$loop$prop$reader$20.readAsDataURL(a[b.$jscomp$loop$prop$i$14$19])}},setOnLoad:function(a){n()||(J=w(a)?a:null)},setOnProgress:function(a){n()||(G=w(a)?a:null)},setOnFinish:function(a){n()||(E=w(a)?a:null)},setOnLog:function(a){m=w(a)?a:null},setFrameDuration:function(a){n()||(a=Number.parseInt(a),I=isNaN(a)?null:a)},setMaxLimit:function(a){n()||(a=
Number.parseInt(a),isNaN(a)||(x=a))},setMinLimit:function(a){n()||(a=Number.parseInt(a),isNaN(a)||(y=a))},setCaptureRate:function(a){n()||(a=Number.parseFloat(a),F=isNaN(a)?null:a)},setLogicDefault:function(){return r=1},setLogicPrioritySize:function(){return r=1},setLogicPriorityFast:function(){return r=0},convert:function(){if(!n())if(0==e.length)l(m,[{level:"warn",message:"No target image, please call loadImage first"}]),console.warn("No target image, please call loadImage first");else if(null==
c)l(m,[{level:"warn",message:"Please call init first"}]),console.warn("Please call init first");else{console.info("Logic : "+(1==r?"PrioritySize":"PriorityFast"));u=!0;var a,b,g;p.width=null!=(g=null!=(b=null!=(a=e[0].width)?a:e[0].naturalWidth)?b:e[0].clientWidth)?g:1;var d,f,k;p.height=null!=(k=null!=(f=null!=(d=e[0].height)?d:e[0].naturalHeight)?f:e[0].clientHeight)?k:1;c.width=p.width;c.height=p.height;Math.max(c.width,c.height)>x&&c.width*c.height>x*y&&(a=1/(Math.max(c.width,c.height)/x),c.width*=
a,c.height*=a);Math.min(c.width,c.height)>y&&c.width*c.height>x*y&&(a=1/(Math.min(c.width,c.height)/y),c.width*=a,c.height*=a);l(m,[{level:"info",message:"OutputVideoSize: ("+c.height+", "+c.width+")"}]);t=[];if(1==r)for(a=0;a<e.length;a++){b=document.createElement("canvas");f=d=g=void 0;b.width=null!=(f=null!=(d=null!=(g=e[a].width)?g:e[a].naturalWidth)?d:e[a].clientWidth)?f:1;f=d=g=void 0;b.height=null!=(f=null!=(d=null!=(g=e[a].height)?g:e[a].naturalHeight)?d:e[a].clientHeight)?f:1;b.getContext("2d").drawImage(e[a],
0,0);g=c;f=b.width/g.width;k=b.height/g.height;if(1!=f||1!=k)d=document.createElement("canvas"),d.width=b.width,d.height=b.height,1!=f&&(f=1/f,d.width*=f,d.height*=f),k=d.height/g.height,1!=k&&(g=1/k,d.width*=g,d.height*=g),d.getContext("2d").drawImage(b,0,0,b.width,b.height,0,0,d.width,d.height),b=d;t[a]={canvas:b,ctx:b.getContext("2d")}}else 0==r&&(H=p.getContext("2d"));A=c.getContext("2d");z=1;q()}},canvas:function(){return c}}}();
